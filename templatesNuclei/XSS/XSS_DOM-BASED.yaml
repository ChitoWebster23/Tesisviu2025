id: xss-dom-based

info:
  name: "XSS DOM-Based con document.write()"
  author: "Fabian Morales"
  severity: Critical
  description: "Detecta vulnerabilidades de XSS basado en DOM cuando el contenido se inyecta dinámicamente mediante document.write()."
  reference:
  tags: xss, dom, reflected, document.write, javascript, security

requests:
  - method: GET
    path:
      - "{{BaseURL}}/?search=<script>document.write('<img src=x onerror=alert(1)>')</script>"
      - "{{BaseURL}}/?q=<svg/onload=alert(1)>"
      - "{{BaseURL}}/?xss=<iframe/src=javascript:alert(1)>"
      - "{{BaseURL}}/?search=\"><svg onload=alert(1)>"

    matchers-condition: or
    matchers:
      - type: word
        words:
          - "<img src=x onerror=alert(1)>"
          - "<svg/onload=alert(1)>"
          - "<iframe/src=javascript:alert(1)>"
        part: body
        name: "XSS DOM detectado en la respuesta"

      - type: regex
        regex:
          - ".*?<script>document\\.write\\(.*?<img src=x onerror=alert\\(1\\)>.*?</script>"
          - ".*?<svg onload=alert\\(1\\)>.*?"
        part: body
        name: "Patrón de document.write() identificado"

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        name: "Elemento vulnerable encontrado"
        pattern:
          - "(document\\.write\\(.*?\\))"
